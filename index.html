<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Introduction to BDD in Rails</title>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  

  

  <script type="text/javascript">
  $(function(){
    setupPreso(false, './');
  });
  </script>
</head>

<body>


<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">&larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">z</td><td>toggle help (this)</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content incremental" ref="slides/introduction/slide/1">
<h1>Introduction to BDD in Rails</h1>

<h2>David Wilkie</h2>

<ul>
<li><h3><a href="http://dwilkie.github.com/rails_bdd_course">http://dwilkie.github.com/rails_bdd_course</a></h3></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="slides/introduction/slide/2">
<h2>Reference</h2>

<h3><a href="http://pragprog.com/">http://pragprog.com/</a></h3>

<ul>
<li><img src="./file/slides/introduction//the-rspec-book.gif" width="230" height="273" alt="Rspec Book"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/introduction/slide/3">
<h2>What is BDD?</h2>

<h3>Behaviour Driven Development is about implementing an application by describing its behavior from the perspective of its stakeholders.</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/introduction/slide/4">
<h2>What does it all mean?</h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/setup/slide/1">
<h2>Learn by doing!</h2></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/setup/slide/2">
<h2>Setup</h2>

<pre><code><code class="command">$ git clone git://github.com/dwilkie/rails_bdd_course.git</code><code class="result">
</code><code class="command">$ cd rails_bdd_course/</code><code class="result">
</code><code class="command">$ git checkout new_store</code><code class="result">
</code><code class="command">$ cd store/</code><code class="result">

Examining /home/dave/work/tmp/rails_bdd_course/store/.rvmrc complete.

================================================================
= Trusting an .rvmrc file means that whenever you cd into the  =
= directory RVM will execute this .rvmrc script in your shell  =
=                                                              =
= Now that you have examined the contents of the file, do you  =
= wish to trust this .rvmrc from now on?                       =
================================================================

(yes or no) &gt; yes
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/setup/slide/3">
<pre><code><code class="command">$ bundle install --path vendor</code><code class="result">

...
Your bundle is complete! It was installed into ./vendor
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="slides/exercise/slide/1">
<h2>Mockup</h2>

<ul>
<li><img src="./file/slides/exercise//list_products.png" width="522" height="500" alt="Mockup"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/2">
<h2>Pop the why? stack</h2>

<h3>You should pop the why stack max 5 times (ask why recursively) until you end up with one of the following business values:</h3>

<ul>
<li><h3>Protect revenue</h3></li>
<li><h3>Increase revenue</h3></li>
<li><h3>Manage cost</h3></li>
<li><h3>Increase brand value</h3></li>
<li><h3>Make the product remarkable</h3></li>
<li><h3>Provide more value to your customers</h3></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/3">
<h2>Why? stack</h2>

<ul>
<li><h3>As a customer why would I want to see a list of products?</h3></li>
<li><h3>So that I can browse through the products on your site</h3></li>
<li><h3>Why do you want browse through the items on our site?</h3></li>
<li><h3>So that I can choose an item to buy</h3></li>
</ul>


<h2>Increases revenue</h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/4">
<h2>Why? stack cont...</h2>

<ul>
<li><h3>Why do you want to see cheap items highlighted</h3></li>
<li><h3>So I can see bargains</h3></li>
<li><h3>Why do you want to see bargains</h3></li>
<li><h3>So that I can buy them!</h3></li>
</ul>


<h2>Increases revenue</h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/5">
<h2>Feature Definition</h2>

<pre class="sh_cucumber"><code>
# features/list_products.feature

Feature: List Products
  In order to purchase a product
           and see bargains
  As a customer
  I want to browse products,
         see the price
         and identify cheap products</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="slides/exercise/slide/6">
<h2>Scenario</h2>

<pre class="sh_cucumber"><code>
Scenario: List Products
  Given the following products exist
    | name   | price |
    | Abc    | 2.99  |
    | Angkor | 0.99  |
  When I go to the products page
  Then I should see "Products"
  And I should see "Name"
  And I should see "Price"
  And I should see "Abc" within "#product_1"
  And I should see "$2.99" within "#product_1"
  And I should see "Angkor" within "#product_2"
  And I should see "$0.99" within "#product_2"</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="slides/exercise/slide/7">
<h2>BDD cycle in Rails</h2>

<h3>Work outside-in (the outside being the feature, the inside being the low level code)</h3>

<ul>
<li><img src="./file/slides/exercise//bdd_rspec_cucumber.jpg" width="791" height="526" alt="BDD cycle in Rails"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/8">
<h2>Generate a product model</h2>

<pre><code><code class="command">$ rails g model product</code><code class="result">
invoke  active_record
create    db/migrate/20110620051418_create_products.rb
create    app/models/product.rb
invoke    rspec
create      spec/models/product_spec.rb
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/9">
<h2>Add name and price to Migration</h2>

<pre class="sh_ruby"><code>
# db/migration/*_create_products.rb

def change
  create_table :products do |t|
    t.string  :name
    t.decimal :price

    t.timestamps
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/10">
<h2>Migrate the db and clone structure to test db</h2>

<pre><code><code class="command">$ bundle exec rake db:migrate</code><code class="result">
</code><code class="command">$ bundle exec rake db:test:clone</code><code class="result">
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/11">
<h2>Start the Spork server and run the features</h2>

<pre><code><code class="command">$ bundle exec spork cuc</code><code class="result">
</code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page
  Can't find mapping from "the products page" to a path.
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/12">
<h2>Add the routes</h2>

<pre class="sh_ruby"><code>
# config/routes.rb

Store::Application.routes.draw do
  resources :products
  ...
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/13">
<h2>Run the features again</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
uninitialized constant ProductsController...
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/14">
<h2>Generate the products controller</h2>

<pre><code><code class="command">$ rails g controller products</code><code class="result">
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/15">
<h2>And again...</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
The action 'index' could not be found for ProductsController
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/16">
<h2>Add the index action</h2>

<pre class="sh_ruby"><code>
# app/controllers/products_controller.rb

class ProductsController &lt; ApplicationController
  def index
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/17">
<h2>Run features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
Missing template products/index
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/18">
<h2>Add the missing template</h2>

<pre><code><code class="command">$ touch app/views/products/index.html.haml</code><code class="result">
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/19">
<h2>Run features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page # passed!
Then I should see "Products"
  expected there to be content "Products"
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/20">
<h2>Enter RSpec</h2>

<pre><code>Then I should see "Products"
  expected there to be content "Products"
</code></pre>

<ul>
<li><img src="./file/slides/exercise//bdd_rspec_cucumber.jpg" width="791" height="526" alt="BDD Cycle in Rails"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/21">
<h2>Let's write a view spec...</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

require 'spec_helper'
describe "products/index.html.haml" do

  context "h1" do
    it "should be 'Products'" do
      render
      rendered.should have_selector(
        "h1", :text =&gt; "Products"
      )
    end
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/22">
<h2>Boot Spork for RSpec</h2>

<pre><code><code class="command">$ bundle exec spork</code><code class="result">
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/23">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected css "h1" with text "Products" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/24">
<h2>Write the code to make the spec pass</h2>

<pre class="sh_ruby"><code>
# app/views/products/index.html.haml

%h1
  Products</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/25">
<h2>Run the view spec again</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
1 example, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/26">
<h2>Now run the features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page # passed!
Then I should see "Products" # passed!
And I should see "Name"
  expected there to be content "Name"
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="slides/exercise/slide/27">
<h2>We need a table with a 'Name' column</h2>

<ul>
<li><img src="./file/slides/exercise//list_products.png" width="522" height="500" alt="Mockup"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/28">
<h2>Back to RSpec</h2>

<h3>Add an example for the table</h3>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml

context "table" do
  it "should be displayed" do
    render
    rendered.should have_selector "table"
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/29">
<h2>Run the spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected css "table" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/30">
<h2>Write the code to make the spec pass</h2>

<pre class="sh_ruby"><code>
# app/views/products/index.html.haml

%h1
  Products
%table</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/31">
<h2>Run the spec again</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
2 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/32">
<h2>Add another example for the header row</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml

context "table" do
 ...
  context "table row" do
    context "header row" do
      it "should display 'Name'" do
        render
        rendered.should have_selector(
          "table tr th", :text =&gt; "Name"
        )
      end
    end
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/33">
<h2>And run the spec again</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected css "table tr th" with text "Name" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/34">
<h2>And write the code to make it pass</h2>

<pre class="sh_ruby"><code>
# app/views/products/index.html.haml

%h1
  Products
%table
  %tr
    %th
      Name</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/35">
<h2>Run the spec again</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
3 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/36">
<h2>Now run the features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page # passed!
Then I should see "Products" # passed!
And I should see "Name" # passed!
And I should see "Price"
  expected there to be content "Price"
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/37">
<h2>Add another example for the 'Price' column</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml

context "header row" do
  it "should display 'Price'" do
    render
    rendered.should have_selector(
      "table tr th", :text =&gt; "Price"
    )
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/38">
<h2>Run the spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected css "table tr th" with text "Price" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/39">
<h2>Write the code to make it pass</h2>

<pre class="sh_ruby"><code>
# app/views/products/index.html.haml

%h1
  Products
%table
  %tr
    %th
      Name
    %th
      Price</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/40">
<h2>Run the spec again</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
4 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/41">
<h2>And run the features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page # passed!
Then I should see "Products" # passed!
And I should see "Name" # passed!
And I should see "Price" # passed!
And I should see "Abc" within "#product_1"
  Unable to find css "#product_1"
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="slides/exercise/slide/42">
<h2>Time to Refactor</h2>

<ul>
<li><img src="./file/slides/exercise//bdd_rspec_cucumber.jpg" width="791" height="526" alt="BDD cycle in Rails"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/43">
<h2>What is refactoring?</h2>

<h3>"Refactoring is the process of changing a software system in such a way that it does not alter the external behavior of the code yet improves its internal structure." [Martin Fowler]</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/44">
<h2>Keeping it DRY</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml
render
rendered.should have_selector(
  "h1", :text =&gt; "Products"
)

render
rendered.should have_selector "table"

render
rendered.should have_selector(
  "table tr th", :text =&gt; "Name"
)

render
rendered.should have_selector(
  "table tr th", :text =&gt; "Price"
)</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/45">
<h2>RSpec's Before Block</h2>

<pre class="sh_ruby"><code>
before do
  # do something here...
end

before { render }</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/46">
<h2>RSpec's <code>let</code></h2>

<h3>Lazy loaded instance variables</h3>

<h3>e.g. <code>let(:product) { Product.new }</code></h3>

<h3>The block <code>Product.new</code> is only executed when <code>product</code> is called within a spec</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/47">
<h2>Helper Methods</h2>

<pre class="sh_ruby"><code>
let(:parent_selector) { [] }

def have_parent_selector(options = {})
  selector = parent_selector.join("/")
  selector = ".//" &lt;&lt; selector
  have_selector :xpath, selector, options
end

context "h1" do
  before {parent_selector &lt;&lt; "h1"}

  it "should be 'Products'" do
    rendered.should have_parent_selector(
      :text =&gt; "Products"
    )
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/48">
<h2>Refactored Spec</h2>

<pre class="sh_ruby"><code>
require 'spec_helper'

describe "products/index.html.haml" do

  let(:parent_selector) { [] }

  def have_parent_selector(options = {})
    selector = parent_selector.join("/")
    selector = ".//" &lt;&lt; selector
    have_selector :xpath, selector, options
  end

  before { render }</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code" ref="slides/exercise/slide/49">
<pre class="sh_ruby"><code>
  context "h1" do
    before {parent_selector &lt;&lt; "h1"}

    it "should be 'Products'" do
      rendered.should have_parent_selector(
        :text =&gt; "Products"
      )
    end
  end

  context "table" do
    before { parent_selector &lt;&lt; "table" }

    it "should be displayed" do
      rendered.should have_parent_selector
    end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code" ref="slides/exercise/slide/50">
<pre class="sh_ruby"><code>
    context "table row" do
      before { parent_selector &lt;&lt; "tr" }

      context "header row" do
        before { parent_selector &lt;&lt; "th" }

        it "should display 'Name'" do
          rendered.should have_parent_selector(
            :text =&gt; "Name"
          )
        end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code" ref="slides/exercise/slide/51">
<pre class="sh_ruby"><code>
        it "should display 'Price'" do
          rendered.should have_parent_selector(
            :text =&gt; "Price"
          )
        end
      end
    end
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/52">
<h2>Run the spec and features again to make sure we didn't break anything</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
4 examples, 0 failure

</code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page # passed!
Then I should see "Products" # passed!
And I should see "Name" # passed!
And I should see "Price" # passed!
And I should see "Abc" within "#product_1"
  Unable to find css "#product_1"
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/53">
<h2>Add another example to view spec</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml

context "table" do
  # ...

  context "row for #product_1" do
    before do
      parent_selector &lt;&lt; "tr[@id='product_1']"
    end

    it "should be displayed" do
      rendered.should have_parent_selector
    end
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/54">
<h2>Run the spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected xpath ".//table/tr[@id='product_1']" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/55">
<h2>Add code to render the products</h2>

<pre class="sh_ruby"><code>
# app/views/products/index.html.haml
%h1
  Products
%table
  %tr
    %th
      Name
    %th
      Price
  = render @products</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/56">
<h2>Add the _product partial</h2>

<pre><code><code class="command">$ touch app/views/products/_product.html.haml</code><code class="result">
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/57">
<h2>And add the id to to the table row</h2>

<pre class="sh_ruby"><code>
# app/views/products/_product.html.haml

%tr{:id =&gt; "product_#{product_counter + 1}"}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/58">
<h2>Run the spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
undefined method `model_name' for NilClass:Class
# ./app/views/products/index.html.haml:9
5 examples, 5 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/59">
<h2>What happened!? We broke all our tests!</h2>

<h3>The failure occurred on line 9 because <code>@products</code> returns nil</h3>

<h3>We need <code>@products</code> to return an enumerable of <code>Product</code> instances</h3>

<h3>But we want to remain focussed on the view layer</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/60">
<h2>RSpec Mocks</h2>

<h3>Allow you to define a 'fake' model which will behave how you want</h3>

<h3>Mocks allow you to keep your view specs isolated from changes in the model an controller layers</h3>

<h3><code>mock_model</code> is an rspec_rails function to create mocks for Rails models</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/61">
<h2>RSpec <code>assigns</code></h2>

<h3>Sets up instance variables to use in your view specs</h3>

<h3>E.g. <code>assigns(:products, [])</code> sets <code>@products</code> as an empty array</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/62">
<h2>Add mocks and assign <code>@products</code> in view spec</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml

let(:abc) {
  mock_model(Product).as_null_object
}

before do
  assign(:products, [abc])
  render
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/63">
<h2>Run the spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
5 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/64">
<h2>Run the features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page
  undefined method `model_name' for NilClass:Class
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="slides/exercise/slide/65">
<h2>Down the RSpec Stack</h2>

<h3>We have a failing Cucumber scenario but a passing view spec</h3>

<h3>We need to go down to the controller layer</h3>

<ul>
<li><img src="./file/slides/exercise//bdd_rspec_cucumber.jpg" width="791" height="526" alt="BDD cycle in Rails"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/66">
<h2>RSpec Controller Specs, Stubs &amp; Message Expectations</h2>

<h3>Controllers should know what to do but <em>not</em> how to do it</h3>

<h3>They are naturally interaction-based</h3>

<h3>Specs make use of RSpec's stubs and message expectations which mock responses and assert that an objects receive messages</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/67">
<h2>Our Example</h2>

<h3>The controller should fetch all the products and assign them to <code>@products</code></h3>

<ul>
<li><h3>Fake the response from <code>Product</code> to return an empty array</h3></li>
<li><h3>Note: <code>scoped</code> is Rails 3 for <code>Product.all</code></h3>

<pre><code>  Product.stub(:scoped).and_return([])
</code></pre></li>
<li><h3>Assert that the controller fetches all the products</h3>

<pre><code>  Product.should_receive(:scoped)
</code></pre></li>
<li><h3>Assert that the controller assigns them to <code>@products</code></h3>

<pre><code>  assigns[:products].should == []
</code></pre></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/68">
<h2>Add a controller spec</h2>

<pre class="sh_ruby"><code>
# spec/controllers/products_controller_spec.rb
require 'spec_helper'

describe ProductsController do
  describe "GET /index" do

    let(:products) { [] }
    before do
      Product.stub(:scoped).and_return(
        products
      )
    end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code" ref="slides/exercise/slide/69">
<pre class="sh_ruby"><code>
    it "should fetch all the products" do
      Product.should_receive(:scoped)
      get :index
    end

    it "should assign @products" do
      get :index
      assigns[:products].should == products
    end
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/70">
<h2>Run the controller spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/controllers/</code><code class="result">
2 examples, 2 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/71">
<h2>Write the code to make the spec pass</h2>

<pre class="sh_ruby"><code>
# app/controllers/products_controller.rb

def index
  @products = Product.scoped
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/72">
<h2>Run the spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/controllers/</code><code class="result">
2 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/73">
<h2>Run the features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page # passed!
Then I should see "Products" # passed!
And I should see "Name" # passed!
And I should see "Price" # passed!
And I should see "Abc" within "#product_1"
  expected there to be content "Abc" in ""
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/74">
<h2>Back to the view spec</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

context "row for #product_1" do
  # ...

  context "table data" do
    before { parent_selector &lt;&lt; "td" }

    it "should contain 'Abc'" do
      rendered.should have_parent_selector(
        :text =&gt; "Abc"
      )
    end
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/75">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected xpath ".//table/tr[@id='product_1']/td" with text "Abc" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/76">
<h2>Add the code to make the spec pass</h2>

<pre class="sh_ruby"><code>
# app/views/products/_product.html.haml

%tr{:id =&gt; "product_#{product_counter + 1}"}
  %td
    = product.name</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/77">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected xpath ".//table/tr[@id='product_1']/td" with text "Abc" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/78">
<h2>Debugging</h2>

<h3>We're stuck. Our new code didn't make the spec pass.</h3>

<h3>Let's debug</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/79">
<h2>Edit the view spec</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

it "should contain 'Abc'" do
  p rendered
  rendered.should have_parent_selector(
    :text =&gt; "Abc"
  )
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/80">
<h2>Run the view spec again</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
&lt;tr id='product_1'&gt;\n&lt;td&gt;\nProduct_#&amp;lt;RSpec...&lt;/td&gt;\n&lt;/tr&gt;
expected xpath ".//table/tr[@id='product_1']/td" with text "Abc" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/81">
<h2>Mocks Revisited</h2>

<h3>In our view spec we mock out our <code>Product</code> object using <code>mock_model(Product)</code></h3>

<h3>But what is <code>.as_null_object</code>?</h3>

<h3><code>.as_null_object</code> tells the mock to ignore messages that it's not expecting and just return something</h3>

<h3>In our case the <code>Product</code> mock is not expecting <code>.name</code> so it returns 'Product_#&lt;RSpec...' which is what we saw from our output</h3>

<h3><code>mock_model</code> also accepts a hash of method/return values which we can use to return the product's name</h3>

<pre class="sh_ruby"><code>
mock_model(Product, :name =&gt; "Abc")</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/82">
<h2>Stub product name and remove debug</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

let(:abc) {
  mock_model(
    Product,
    :name =&gt; "Abc",
  ).as_null_object
}

it "should contain 'Abc'" do
  rendered.should have_parent_selector(
    :text =&gt; "Abc"
  )
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/83">
<h2>Run the view spec again</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
6 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/84">
<h2>Run the features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page # passed!
Then I should see "Products" # passed!
And I should see "Name" # passed!
And I should see "Price" # passed!
And I should see "Abc" within "#product_1" # passed!
And I should see "$2.99" within "#product_1"
  expected there to be content "$2.99" in "\nAbc\n\n"
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/85">
<h2>Add a new example to the view spec</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

context "table data" do
  # ...

  it "should contain '$2.99'" do
    rendered.should have_parent_selector(
      :text =&gt; "$2.99"
    )
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/86">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected xpath ".//table/tr[@id='product_1']/td" with text "$2.99" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/87">
<h2>Add the code to make the spec pass</h2>

<pre class="sh_ruby"><code>
# app/views/products/_product.html.haml

%tr{:id =&gt; "product_#{product_counter + 1}"}
  %td
    = product.name
  %td
    = product.price</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/88">
<h2>Stub product price</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

let(:abc) {
  mock_model(
    Product,
    :name =&gt; "Abc",
    :price =&gt; 2.99
  ).as_null_object
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/89">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected xpath ".//table/tr[@id='product_1']/td" with text "$2.99" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/90">
<h2>Something <em>still</em> wrong</h2>

<h3>Debug</h3>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

it "should contain '$2.99'" do
  p rendered
  rendered.should have_parent_selector(
    :text =&gt; "$2.99"
  )
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/91">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
...&lt;td&gt;\n2.99\n&lt;/td&gt;...
expected xpath ".//table/tr[@id='product_1']/td" with text "$2.99" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/92">
<h2>What are we missing?</h2>

<h3>$$$</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/93">
<h2>Fix the code using Rails' <code>number_to_currency</code> and remove debug line</h2>

<pre class="sh_ruby"><code>
# app/views/products/_product.html.haml

%tr{:id =&gt; "product_#{product_counter + 1}"}
  %td
    = product.name
  %td
    = number_to_currency product.price

# spec/views/products/index.html.haml_spec.rb

it "should contain '$2.99'" do
  rendered.should have_parent_selector(
    :text =&gt; "$2.99"
  )
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/94">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
7 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/95">
<h2>Run the features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page                # passed!
Then I should see "Products"                  # passed!
And I should see "Name"                       # passed!
And I should see "Price"                      # passed!
And I should see "Abc" within "#product_1"    # passed!
And I should see "$2.99" within "#product_1"  # passed!
And I should see "Angkor" within "#product_2" # passed!
And I should see "$0.99" within "#product_2"  # passed!
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/96">
<h2>Everything is GREEN!</h2>

<h3>Let's manually check our work</h3>

<pre><code><code class="command">$ rails s</code><code class="result">
=&gt; Booting WEBrick
=&gt; Rails 3.1.0.rc4 application starting in development on http://0.0.0.0:3000
=&gt; Call with -d to detach
=&gt; Ctrl-C to shutdown server
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/97">
<h2><a href="http://localhost:3000/products">http://localhost:3000/products</a></h2></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/98">
<h2>Create some products</h2>

<pre><code><code class="command">$ rails c</code><code class="result">
</code><code class="command">$ Product.create(:name =&gt; "Abc", :price =&gt; 2.99)</code><code class="result">
=&gt; #&lt;Product id: 1, name: "Abc", price: ...
</code><code class="command">$ Product.create(:name =&gt; "Angkor", :price =&gt; 0.99)</code><code class="result">
=&gt; #&lt;Product id: 2, name: "Angkor", price: ...
</code><code class="command">$ Product.create(:name =&gt; "Crown", :price =&gt; 4.99)</code><code class="result">
=&gt; #&lt;Product id: 3, name: "Crown", price: ...
</code><code class="command">$ Product.create(:name =&gt; "Klang", :price =&gt; 5.00)</code><code class="result">
=&gt; #&lt;Product id: 4, name: "Klang", price: ...
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/99">
<h2><a href="http://localhost:3000/products">http://localhost:3000/products</a></h2></div>
</div><div class="slide" data-transition="none"><div class="content center increment" ref="slides/exercise/slide/100">
<h2>Our Mockup</h2>

<ul>
<li><img src="./file/slides/exercise//list_products.png" width="522" height="500" alt="Mockup"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/101">
<h2>Styling</h2>

<h3>Change to SASS</h3>

<pre><code><code class="command">$ mv app/assets/stylesheets/products.css.scss \</code><code class="result">
</code><code class="command">$ app/assets/stylesheets/products.css.sass</code><code class="result">
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/102">
<h2>Add some SASS</h2>

<pre class="sh_css"><code>
# app/assets/stylesheets/products.css.sass

table#products
  border-collapse: collapse
  th, td
    padding: 5px
    border: 1px solid black
  th
    background-color: gray</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/103">
<h2><a href="http://localhost:3000/products">http://localhost:3000/products</a></h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/104">
<h2>Specifying CSS elements</h2>

<h3>For the designer we need to ensure that our app renders a table with <code>#products</code></h3>

<h3>This belongs in the view spec</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/105">
<h2>Specify <code>#products</code></h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

context "table" do
  before do
    parent_selector &lt;&lt;
      "table[@id = 'products']"
  end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/106">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
7 examples, 6 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/107">
<h2>Fix the code to make the specs pass</h2>

<pre class="sh_ruby"><code>
# app/views/products/index.html.haml

%h1
  Products
%table#products
  %tr</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/108">
<h2>Run the view spec again</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
7 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/109">
<h2><a href="http://localhost:3000/products">http://localhost:3000/products</a></h2></div>
</div><div class="slide" data-transition="none"><div class="content center increment" ref="slides/exercise/slide/110">
<h2>Our Mockup</h2>

<ul>
<li><img src="./file/slides/exercise//list_products.png" width="522" height="500" alt="Mockup"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/111">
<h2>Add some more SASS</h2>

<pre class="sh_css"><code>
# app/assets/stylesheets/products.css.sass

table#products
  // ...
  tr.cheap
    background-color: #00CCFF</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/112">
<h2>Add a cheap product to the view spec</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

let(:angkor) {
  mock_model(
    Product,
    :name =&gt; "Angkor",
    :price =&gt; 0.99
  ).as_null_object
}

before do
  assign(:products, [abc, angkor])
  render
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/113">
<h2>Add an example for the new product</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

context "row for #product_1" do
  # ...
end

context "row for #product_2" do
  before do
    parent_selector &lt;&lt;
      "tr[@id='product_2' and @class='cheap']"
  end

  it "should be displayed" do
    rendered.should have_parent_selector
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/114">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected xpath "/tr[@id='product_2' and @class='cheap']" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/115">
<h2>Add the code to make the spec pass</h2>

<pre class="sh_ruby"><code>
# app/views/products/_product.html.haml

%tr{:id =&gt; ..., :class =&gt; "cheap"}
  %td
    = product.name</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/116">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
8 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/117">
<h2><a href="http://localhost:3000/products">http://localhost:3000/products</a></h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/118">
<h2>Modify spec to make this fail</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

context "row for #product_1" do
  before do
    parent_selector &lt;&lt;
      "tr[@id='product_1' and not(@class)]"
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/119">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
expected xpath "tr[@id='product_1' and not(@class)]" to return something
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/120">
<h2>Write the code in the view that we wish we had</h2>

<pre class="sh_ruby"><code>
# app/views/products/_product.html.haml

- row_class = product.cheap? ? |
  {:class =&gt; "cheap"} : {}     |

%tr{{:id =&gt; "..."}.merge(row_class)}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/121">
<h2>We discovered that we need a method <code>Product#cheap?</code></h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/122">
<h2>Stay focussed on the view layer</h2>

<pre class="sh_ruby"><code>
# spec/views/products/index.html.haml_spec.rb

let(:abc) {
  mock_model(
    # ...,
    :price =&gt; 2.99,
    :cheap? =&gt; false
  ).as_null_object
}

let(:angkor) {
  mock_model(
    # ...,
    :price =&gt; 0.99,
    :cheap? =&gt; true
  ).as_null_object
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/123">
<h2>Run the view spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/views/</code><code class="result">
8 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/124">
<h2>Run the features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page
  undefined method `cheap?' for #&lt;Product&gt;
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content center incremental" ref="slides/exercise/slide/125">
<h2>Now let's go down to the model layer</h2>

<ul>
<li><img src="./file/slides/exercise//bdd_rspec_cucumber.jpg" width="791" height="526" alt="BDD cycle in Rails"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/126">
<h2>Add a model spec</h2>

<pre class="sh_ruby"><code>
# spec/models/product_spec.rb

require 'spec_helper'

describe Product do

end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/127">
<h2>And add some examples</h2>

<pre class="sh_ruby"><code>
describe "#cheap?" do
  context "a cheap product" do
    before { subject.price = 0.99 }

    it "should return true" do
      subject.should be_cheap
    end
  end

  context "a not-so-cheap product" do
    before { subject.price = 1.00 }

    it "should return false" do
      subject.should_not be_cheap
    end
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/128">
<h2>Run the model spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/models/</code><code class="result">
undefined method `cheap?' for #&lt;Product&gt;
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/129">
<h2>Write just enough code to make it pass</h2>

<pre class="sh_ruby"><code>
class Product &lt; ActiveRecord::Base
  def cheap?
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/130">
<h2>Run the model spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/models/</code><code class="result">
expected cheap? to return true, got nil
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/131">
<h2>Repeat. Write just enough code to make it pass</h2>

<pre class="sh_ruby"><code>
class Product &lt; ActiveRecord::Base
  def cheap?
    price &lt; 1
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/132">
<h2>Run the model spec</h2>

<pre><code><code class="command">$ bundle exec rspec --drb spec/models/</code><code class="result">
2 examples, 0 failures
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/133">
<h2>Run the features</h2>

<pre><code><code class="command">$ bundle exec cucumber features/</code><code class="result">
When I go to the products page                # passed!
Then I should see "Products"                  # passed!
And I should see "Name"                       # passed!
And I should see "Price"                      # passed!
And I should see "Abc" within "#product_1"    # passed!
And I should see "$2.99" within "#product_1"  # passed!
And I should see "Angkor" within "#product_2" # passed!
And I should see "$0.99" within "#product_2"  # passed!
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/134">
<h2><a href="http://localhost:3000/products">http://localhost:3000/products</a></h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/135">
<h2>Done!</h2></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="slides/exercise/slide/136">
<h2>More Tips</h2>

<pre><code><code class="command">$ bundle exec rspec --drb -f d spec/</code><code class="result">
</code><code class="command">$ bundle exec rake spec</code><code class="result">
</code><code class="command">$ bundle exec rake cucumber</code><code class="result">
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="slides/exercise/slide/137">
<h2>More Info</h2>

<h3><a href="http://cukes.info">http://cukes.info</a></h3>

<h3><a href="http://relishapp.com/rspec">http://relishapp.com/rspec</a></h3></div>
</div></div>

</body>
</html>
